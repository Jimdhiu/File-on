
<% @procedure_requests.each do |procedure_request| %>
<p> <%= procedure_request.procedure.name %> - <%= procedure_request.part.email %> </p>
<!-- <p><%= procedure_request.procedure.tags.pluck(:name) %> </p> -->
<!-- <p><%= procedure_request.documents.pluck(:id) %> </p> -->
  <% procedure_request.procedure.tags.each do |tag| %>
    <%= tag.name %>
      <ul>
        <% procedure_request.part.documents.where(tag: tag).each do |document| %>
          <li>
            <%= document.tag.name %> <%= document.document_date %>
            <% if document.expired? %>
              <i class="fa fa-exclamation-circle expiration-icon" aria-hidden="true"> Date de validité dépassée</i>
            <% else %>
              <i class="fa fa-check presence-icon" aria-hidden="true"></i>
            <% end %>
          </li>
        <% end %>
      </ul>

<% end %>

<% end %>

<% @procedure_requests.each do |procedure_request| %>
  <div class="panel panel-default">

    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse<%= category.id %>" aria-expanded="true" aria-controls="collapse<%= category.id %>">
      <div class="panel-heading category" role="tab" id="headingOne">
        <h4 class="panel-title text-center">
             <span class="pull-left"> <i class="<%= category.icon %> " aria-hidden="true"></i></span><%=procedure_request.procedure.name %> <%= procedure_request.part.email %>


            <% if procedure_request.valid_for?(current_user) %>

              <i class="fa fa-check presence-icon" aria-hidden="true"></i>
            <% else %>
              <i class="fa fa-exclamation-circle expiration-icon" aria-hidden="true"></i>
            <% end %>
            <span class="pull-right"> <%= procedure_request.progression(current_user) %></span>
        </h4>

      </div>
    </a>


    <div id="collapse<%= category.id %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <div class="panel-group first-child" id="accordion<%= category.id %>" role="tablist" aria-multiselectable="true">

          <% procedure_request.tags.each do |tag| %>
              <% if tag.complete_for?(current_user) %>


                  <% @documents.where(tag: tag).each do |document| %>
                    <%= render 'modal', tag: tag, document: document  %>
                    <% if document.expired? %>
                      <i class="fa fa-exclamation-circle expiration-icon" aria-hidden="true"> Date de validité dépassée</i>
                    <% else %>
                      <i class="fa fa-check presence-icon" aria-hidden="true"></i>
                    <% end %>

                  <% end %>
